"use strict";(self.webpackChunkspiceaidocs=self.webpackChunkspiceaidocs||[]).push([[8313],{1296:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>o,contentTitle:()=>d,default:()=>a,frontMatter:()=>i,metadata:()=>c,toc:()=>h});var n=r(4848),s=r(8453);const i={title:"Query History",sidebar_label:"Query History",pagination_prev:"reference/index",pagination_next:null,sidebar_position:6},d=void 0,c={id:"reference/query_history",title:"Query History",description:"The Spice runtime stores information about completed queries in the spice.runtime.query_history table. Each query executed has a row in this table, and the data is retained for one day. Use a SELECT query to return information about each query as shown in this example:",source:"@site/docs/reference/query_history.md",sourceDirName:"reference",slug:"/reference/query_history",permalink:"/reference/query_history",draft:!1,unlisted:!1,editUrl:"https://github.com/spiceai/docs/tree/trunk/spiceaidocs/docs/reference/query_history.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{title:"Query History",sidebar_label:"Query History",pagination_prev:"reference/index",pagination_next:null,sidebar_position:6},sidebar:"docsSidebar",previous:{title:"Reference",permalink:"/reference/"}},o={},h=[{value:"Columns in spice.runtime.query_history",id:"columns-in-spiceruntimequery_history",level:2},{value:"Execution Status Codes",id:"execution-status-codes",level:3}];function l(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(t.p,{children:["The Spice runtime stores information about completed queries in the ",(0,n.jsx)(t.code,{children:"spice.runtime.query_history"})," table. Each query executed has a row in this table, and the data is retained for one day. Use a ",(0,n.jsx)(t.code,{children:"SELECT"})," query to return information about each query as shown in this example:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-sql",children:"SELECT\n  *\nFROM\nspice.runtime.query_history\nLIMIT\n  100;\n"})}),"\n",(0,n.jsx)(t.h2,{id:"columns-in-spiceruntimequery_history",children:"Columns in spice.runtime.query_history"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Column Name"}),(0,n.jsx)(t.th,{children:"Data Type"}),(0,n.jsx)(t.th,{children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"query_id"}),(0,n.jsx)(t.td,{children:"Utf8"}),(0,n.jsx)(t.td,{children:"The unique identifier of the SQL query."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"schema"}),(0,n.jsx)(t.td,{children:"Utf8"}),(0,n.jsx)(t.td,{children:"The schema of the query result."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"sql"}),(0,n.jsx)(t.td,{children:"Utf8"}),(0,n.jsx)(t.td,{children:"The query text of the SQL statement."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"nsql"}),(0,n.jsx)(t.td,{children:"Utf8"}),(0,n.jsx)(t.td,{children:"Optional. If the query was generated through the natural language to SQL API, the natural language text of the query."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"start_time"}),(0,n.jsx)(t.td,{children:"Timestamp(Nanosecond, None)"}),(0,n.jsx)(t.td,{children:"The query execution start time (UTC)."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"end_time"}),(0,n.jsx)(t.td,{children:"Timestamp(Nanosecond, None)"}),(0,n.jsx)(t.td,{children:"The query execution end time (UTC)."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"execution_time"}),(0,n.jsx)(t.td,{children:"Float32"}),(0,n.jsx)(t.td,{children:"The total execution time in seconds."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"execution_status"}),(0,n.jsx)(t.td,{children:"Int8"}),(0,n.jsxs)(t.td,{children:["The ",(0,n.jsx)(t.a,{href:"/reference/query_history#execution-status-codes",children:"status code"})," returned from query execution."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"rows_produced"}),(0,n.jsx)(t.td,{children:"UInt64"}),(0,n.jsx)(t.td,{children:"The total number of rows returned from the query."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"results_cache_hit"}),(0,n.jsx)(t.td,{children:"Boolean"}),(0,n.jsx)(t.td,{children:"True if the result of the query was returned from the results cache, otherwise, false."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"error_message"}),(0,n.jsx)(t.td,{children:"Utf8"}),(0,n.jsx)(t.td,{children:"The error message that was returned."})]})]})]}),"\n",(0,n.jsx)(t.h3,{id:"execution-status-codes",children:"Execution Status Codes"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Value"}),(0,n.jsx)(t.th,{children:"Status"}),(0,n.jsx)(t.th,{children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"0"}),(0,n.jsx)(t.td,{children:"Success"}),(0,n.jsx)(t.td,{children:"The query completed with no errors."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"-10"}),(0,n.jsx)(t.td,{children:"Syntax Error"}),(0,n.jsx)(t.td,{children:"The SQL query text provided has a syntax error. For instance, a misspelled SQL statement was in the query."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"-20"}),(0,n.jsx)(t.td,{children:"Query Planning Error"}),(0,n.jsx)(t.td,{children:"An error occurred while mapping the SQL query to a query plan. For instance, attempting to call a function that does not exist, or providing a query with unsupported types."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"-30"}),(0,n.jsx)(t.td,{children:"Query Execution Error"}),(0,n.jsx)(t.td,{children:"An error occurred during execution due to a malformed input. For instance, passing malformed arguments to a SQL method."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"-120"}),(0,n.jsx)(t.td,{children:"Internal Error"}),(0,n.jsx)(t.td,{children:"An internal error occurred within Spice."})]})]})]})]})}function a(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}},8453:(e,t,r)=>{r.d(t,{R:()=>d,x:()=>c});var n=r(6540);const s={},i=n.createContext(s);function d(e){const t=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:d(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);