"use strict";(self.webpackChunkspiceaidocs=self.webpackChunkspiceaidocs||[]).push([[7697],{3481:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>d});var t=i(4848),s=i(8453);const r={title:"Helm - Kubernetes",sidebar_label:"Helm - Kubernetes",sidebar_position:1,description:"Deploy Spice.ai in Kubernetes using Helm.",pagination_prev:"deployment/index",pagination_next:null},a=void 0,o={id:"deployment/kubernetes/index",title:"Helm - Kubernetes",description:"Deploy Spice.ai in Kubernetes using Helm.",source:"@site/docs/deployment/kubernetes/index.md",sourceDirName:"deployment/kubernetes",slug:"/deployment/kubernetes/",permalink:"/deployment/kubernetes/",draft:!1,unlisted:!1,editUrl:"https://github.com/spiceai/docs/tree/trunk/spiceaidocs/docs/deployment/kubernetes/index.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"Helm - Kubernetes",sidebar_label:"Helm - Kubernetes",sidebar_position:1,description:"Deploy Spice.ai in Kubernetes using Helm.",pagination_prev:"deployment/index",pagination_next:null},sidebar:"docsSidebar",previous:{title:"Deployment",permalink:"/deployment/"}},l={},d=[{value:"TL;DR",id:"tldr",level:2},{value:"Values",id:"values",level:2},{value:"Spicepod",id:"spicepod",level:3},{value:"Common Parameters",id:"common-parameters",level:3},{value:"Adding extra environment variables",id:"adding-extra-environment-variables",level:3},{value:"Monitoring",id:"monitoring",level:3},{value:"Example values.yaml",id:"example-valuesyaml",level:3}];function c(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,s.R)(),...e.components},{Details:i}=n;return i||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"tldr",children:"TL;DR"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"helm repo add spiceai https://helm.spiceai.org\nhelm upgrade --install spiceai spiceai/spiceai\n"})}),"\n",(0,t.jsx)(n.p,{children:"Deploy Spice using Helm in Kubernetes."}),"\n",(0,t.jsx)(n.h2,{id:"values",children:"Values"}),"\n",(0,t.jsxs)(n.p,{children:["The following table lists the configurable parameters of the Spice.ai chart and their default values. Override the default values by creating a ",(0,t.jsx)(n.code,{children:"values.yaml"})," file."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"helm upgrade --install spiceai spiceai/spiceai -f values.yaml\n"})}),"\n",(0,t.jsx)(n.h3,{id:"spicepod",children:"Spicepod"}),"\n",(0,t.jsxs)(n.p,{children:["Add a custom Spicepod to be loaded by the Spice.ai runtime by overriding the ",(0,t.jsx)(n.code,{children:"spicepod"})," value in the ",(0,t.jsx)(n.code,{children:"values.yaml"})," file."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"spicepod:\n  name: app\n  version: v1beta1\n  kind: Spicepod\n\n  datasets:\n    - from: s3://spiceai-demo-datasets/taxi_trips/2024/\n      name: taxi_trips\n      description: Demo taxi trips in s3\n      acceleration:\n        enabled: true\n"})}),"\n",(0,t.jsx)(n.h3,{id:"common-parameters",children:"Common Parameters"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Name"}),(0,t.jsx)(n.th,{children:"Description"}),(0,t.jsx)(n.th,{children:"Value"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"image.repository"})}),(0,t.jsx)(n.td,{children:"The repository of the Docker image ."}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"spiceai"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"image.tag"})}),(0,t.jsx)(n.td,{children:"Replace with a specific version of Spice.ai to run."}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"latest"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"monitoring.podMonitoring.enabled"})}),(0,t.jsxs)(n.td,{children:["Enable Prometheus metrics collection for the Spice pods. Requires the ",(0,t.jsx)(n.a,{href:"https://prometheus-operator.dev/docs/operator/api/#monitoring.coreos.com/v1.PodMonitor",children:"Prometheus Operator"})," CRDs."]}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"false"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"replicaCount"})}),(0,t.jsx)(n.td,{children:"Number of Spice.ai replicas to run"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"1"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"image.pullSecrets"})}),(0,t.jsx)(n.td,{children:"Specify docker-registry secret names as an array"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"[]"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"tolerations"})}),(0,t.jsx)(n.td,{children:"List of node taints to tolerate"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"[]"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"resources"})}),(0,t.jsx)(n.td,{children:"Resource requests and limits for the Spice.ai container"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"{}"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"additionalEnv"})}),(0,t.jsx)(n.td,{children:"Additional environment variables to set in the Spice.ai container"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"[]"})})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"adding-extra-environment-variables",children:"Adding extra environment variables"}),"\n",(0,t.jsxs)(n.p,{children:["Add extra environment variables using the ",(0,t.jsx)(n.code,{children:"additionalEnv"})," property. This can be useful when combining with the ",(0,t.jsx)(n.a,{href:"/secret-stores/env/",children:"Environement Secret Store"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"additionalEnv:\n  - name: SPICE_SECRET_SPICEAI_KEY\n    valueFrom:\n      secretKeyRef:\n        name: spice-secrets\n        key: spiceai-key\n"})}),"\n",(0,t.jsx)(n.h3,{id:"monitoring",children:"Monitoring"}),"\n",(0,t.jsxs)(n.p,{children:["The Spice Helm chart includes compatibility with the ",(0,t.jsx)(n.a,{href:"https://prometheus-operator.dev/",children:"Prometheus Operator"})," for collecting Prometheus metrics that can be visualized in the ",(0,t.jsx)(n.a,{href:"/clients/grafana/",children:"Spice Grafana dashboard"}),". To enable this feature, set the ",(0,t.jsx)(n.code,{children:"monitoring.podMonitoring.enabled"})," value to ",(0,t.jsx)(n.code,{children:"true"}),". This will create a ",(0,t.jsx)(n.code,{children:"PodMonitor"})," resource for the Spice.ai pods that will configure Prometheus to scrape metrics from the Spice.ai pods."]}),"\n",(0,t.jsxs)(i,{children:[(0,t.jsx)("summary",{children:"Install the Prometheus Operator"}),(0,t.jsxs)("div",{children:[(0,t.jsxs)(n.p,{children:["The easiest way to install the Prometheus Operator along with Grafana is to use the ",(0,t.jsx)(n.a,{href:"https://github.com/prometheus-community/helm-charts/blob/main/charts/kube-prometheus-stack/README.md",children:"kube-prometheus-stack"})," Helm chart."]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"helm repo add prometheus-community https://prometheus-community.github.io/helm-charts\nhelm repo update\nhelm install prometheus-stack prometheus-community/kube-prometheus-stack \\\n      --set prometheus.prometheusSpec.podMonitorSelectorNilUsesHelmValues=false \\\n      --set prometheus.prometheusSpec.serviceMonitorSelectorNilUsesHelmValues=false\n"})})]})]}),"\n",(0,t.jsx)(n.p,{children:"Deploy the Spice.ai Helm chart with monitoring enabled:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"helm upgrade --install spiceai spiceai/spiceai --set monitoring.podMonitoring.enabled=true\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Once the monitoring is enabled, import the ",(0,t.jsx)(n.a,{href:"/clients/grafana/",children:"Spice Grafana dashboard"})," to visualize the Spice.ai metrics."]}),"\n",(0,t.jsx)(n.h3,{id:"example-valuesyaml",children:"Example values.yaml"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"image:\n  repository: spiceai/spiceai\n  tag: 0.10.0-alpha\nreplicaCount: 1\nadditionalEnv:\n  - name: SPICE_SECRET_SPICEAI_KEY\n    valueFrom:\n      secretKeyRef:\n        name: spice-secrets\n        key: spiceai-key\nmonitoring:\n  podMonitor:\n    enabled: true\nspicepod:\n  name: app\n  version: v1beta1\n  kind: Spicepod\n\n  datasets:\n    - from: s3://spiceai-demo-datasets/taxi_trips/2024/\n      name: taxi_trips\n      description: Demo taxi trips in s3\n      acceleration:\n        enabled: true\n        # Uncomment to refresh the acceleration on a schedule\n        # refresh_check_interval: 1h\n        # refresh_mode: full\n"})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>o});var t=i(6540);const s={},r=t.createContext(s);function a(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);