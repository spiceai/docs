"use strict";(self.webpackChunkspiceaidocs=self.webpackChunkspiceaidocs||[]).push([[2771],{90:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>c,toc:()=>d});var a=s(4848),t=s(8453);const i={title:"Search Functionality",sidebar_label:"Search",description:"Learn how Spice can search across datasets using database-native and vector-search methods.",sidebar_position:6,pagination_prev:null,pagination_next:null},r=void 0,c={id:"features/search/index",title:"Search Functionality",description:"Learn how Spice can search across datasets using database-native and vector-search methods.",source:"@site/docs/features/search/index.md",sourceDirName:"features/search",slug:"/features/search/",permalink:"/features/search/",draft:!1,unlisted:!1,editUrl:"https://github.com/spiceai/docs/tree/trunk/spiceaidocs/docs/features/search/index.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{title:"Search Functionality",sidebar_label:"Search",description:"Learn how Spice can search across datasets using database-native and vector-search methods.",sidebar_position:6,pagination_prev:null,pagination_next:null},sidebar:"docsSidebar"},o={},d=[{value:"SQL-Based Search",id:"sql-based-search",level:2},{value:"Vector Search",id:"vector-search",level:2},{value:"Chunking Support",id:"chunking-support",level:3},{value:"Document Retrieval",id:"document-retrieval",level:3}];function l(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:"Spice provides advanced search capabilities that go beyond standard SQL queries, offering both traditional SQL search patterns and vector-based search functionality."}),"\n",(0,a.jsx)(n.h2,{id:"sql-based-search",children:"SQL-Based Search"}),"\n",(0,a.jsxs)(n.p,{children:["Spice supports basic search patterns directly through SQL, leveraging its SQL query features. For example, you can perform a text search within a table using SQL's ",(0,a.jsx)(n.code,{children:"LIKE"})," clause:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"SELECT id, text_column\nFROM my_table\nWHERE\n    LOWER(text_column) LIKE '%search_term%'\n  AND\n    date_published > '2021-01-01'\n"})}),"\n",(0,a.jsx)(n.h2,{id:"vector-search",children:"Vector Search"}),"\n",(0,a.jsx)(n.p,{children:"In addition to SQL, Spice provides advanced vector-based search capabilities, enabling more nuanced and intelligent searches. The runtime supports both:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["Local embedding models, e.g. ",(0,a.jsx)(n.a,{href:"https://huggingface.co/sentence-transformers/all-MiniLM-L6-v2",children:"sentence-transformers/all-MiniLM-L6-v2"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:["Remote embedding providers, e.g. ",(0,a.jsx)(n.a,{href:"https://platform.openai.com/docs/api-reference/embeddings/create",children:"OpenAI"}),"."]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["Embedding models are defined in the ",(0,a.jsx)(n.code,{children:"spicepod.yaml"})," file as top-level components."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"embeddings:\n  - from: openai\n    name: remote_service\n    params:\n      openai_api_key: ${ secrets:SPICE_OPENAI_API_KEY }\n\n  - name: local_embedding_model\n    from: huggingface:huggingface.co/sentence-transformers/all-MiniLM-L6-v2\n"})}),"\n",(0,a.jsx)(n.p,{children:"Datasets can be augmented with embeddings targeting specific columns, to enable search capabilities through similarity searches."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"datasets:\n  - from: github:github.com/spiceai/spiceai/issues\n    name: spiceai.issues\n    acceleration:\n      enabled: true\n    embeddings:\n      - column: body # The text column in the `spiceai.issues` dataset\n        use: local_embedding_model # Embedding model used for this column\n"})}),"\n",(0,a.jsxs)(n.p,{children:["By defining embeddings on the ",(0,a.jsx)(n.code,{children:"body"})," column, Spice is now configured to execute similarity searches on the dataset."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:'curl -XPOST http://localhost:8090/v1/search \\\n  -H \'Content-Type: application/json\' \\\n  -d \'{\n    "datasets": ["spiceai.issues"],\n    "text": "cutting edge AI",\n    "where": "author=\\"jeadie\\"",\n    "additional_columns": ["title", "state"],\n    "limit": 2\n  }\'\n'})}),"\n",(0,a.jsxs)(n.p,{children:["For more details, see the ",(0,a.jsx)(n.a,{href:"/api/http/search",children:"API reference for /v1/search"}),"."]}),"\n",(0,a.jsx)(n.h3,{id:"chunking-support",children:"Chunking Support"}),"\n",(0,a.jsxs)(n.p,{children:["Spice also supports chunking of content before embedding, which is useful for large text columns such as those found in ",(0,a.jsx)(n.a,{href:"/components/data-connectors/#document-support",children:"Document Tables"}),". Chunking ensures that only the most relevant portions of text are returned during search queries. Chunking is configured as part of the embedding configuration."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"datasets:\n  - from: github:github.com/spiceai/spiceai/issues\n    name: spiceai.issues\n    acceleration:\n      enabled: true\n    embeddings:\n      - column: body\n        use: local_embedding_model\n        chunking:\n          enabled: true\n          target_chunk_size: 512\n"})}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"body"})," column will be divided into chunks of approximately 512 tokens, while maintaining structural and semantic integrity (e.g. not splitting sentences)."]}),"\n",(0,a.jsx)(n.h3,{id:"document-retrieval",children:"Document Retrieval"}),"\n",(0,a.jsxs)(n.p,{children:["When performing searches on datasets with chunking enabled, Spice returns the most relevant chunk for each match. To retrieve the full content of a column, include the embedding column in the ",(0,a.jsx)(n.code,{children:"additional_columns"})," list."]}),"\n",(0,a.jsx)(n.p,{children:"For example:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:'curl -XPOST http://localhost:8090/v1/search \\\n  -H \'Content-Type: application/json\' \\\n  -d \'{\n    "datasets": ["spiceai.issues"],\n    "text": "cutting edge AI",\n    "where": "array_has(assignees, \\"jeadie\\")",\n    "additional_columns": ["title", "state", "body"],\n    "limit": 2\n  }\'\n'})}),"\n",(0,a.jsx)(n.p,{children:"Response:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "matches": [\n    {\n      "value": "implements a scalar UDF `array_distance`:\\n```\\narray_distance(FixedSizeList[Float32], FixedSizeList[Float32])",\n      "dataset": "spiceai.issues",\n      "metadata": {\n        "title": "Improve scalar UDF array_distance",\n        "state": "Closed",\n        "body": "## Overview\\n- Previous PR https://github.com/spiceai/spiceai/pull/1601 implements a scalar UDF `array_distance`:\\n```\\narray_distance(FixedSizeList[Float32], FixedSizeList[Float32])\\narray_distance(FixedSizeList[Float32], List[Float64])\\n```\\n\\n### Changes\\n - Improve using Native arrow function, e.g. `arrow_cast`, [`sub_checked`](https://arrow.apache.org/rust/arrow/array/trait.ArrowNativeTypeOp.html#tymethod.sub_checked)\\n - Support a greater range of array types and numeric types\\n - Possibly create a sub operator and UDF, e.g.\\n\\t- `FixedSizeList[Float32] - FixedSizeList[Float32]`\\n\\t- `Norm(FixedSizeList[Float32])`"\n      }\n    },\n    {\n      "value": "est external tools being returned for toolusing models",\n      "dataset": "spiceai.issues",\n      "metadata": {\n        "title": "Automatic NSQL retries in /v1/nsql ",\n        "state": "Open",\n        "body": "To mimic our ability for LLMs to repeatedly retry tools based on errors, the `/v1/nsql`, which does not use this same paradigm, should retry internally.\\n\\nIf possible, improve the structured output to increase the likelihood of valid SQL in the response. Currently we just inforce JSON like this\\n```json\\n{\\n  "sql": "SELECT ..."\\n}\\n```"\n      }\n    }\n  ],\n  "duration_ms": 45\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>c});var a=s(6540);const t={},i=a.createContext(t);function r(e){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);