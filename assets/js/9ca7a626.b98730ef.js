"use strict";(self.webpackChunkspiceaidocs=self.webpackChunkspiceaidocs||[]).push([[3414],{7930:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>s,metadata:()=>i,toc:()=>l});var a=r(4848),n=r(8453);const s={title:"Data Refresh",sidebar_label:"Data Refresh",description:"Data refresh for accelerated datasets",sidebar_position:1,pagination_prev:null,pagination_next:null},d=void 0,i={id:"data-accelerators/data-refresh",title:"Data Refresh",description:"Data refresh for accelerated datasets",source:"@site/docs/data-accelerators/data-refresh.md",sourceDirName:"data-accelerators",slug:"/data-accelerators/data-refresh",permalink:"/data-accelerators/data-refresh",draft:!1,unlisted:!1,editUrl:"https://github.com/spiceai/docs/tree/trunk/spiceaidocs/docs/data-accelerators/data-refresh.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"Data Refresh",sidebar_label:"Data Refresh",description:"Data refresh for accelerated datasets",sidebar_position:1,pagination_prev:null,pagination_next:null},sidebar:"docsSidebar"},c={},l=[{value:"Refresh Modes",id:"refresh-modes",level:2},{value:"Filtered Refresh",id:"filtered-refresh",level:2},{value:"Refresh SQL",id:"refresh-sql",level:3},{value:"Refresh Data Window",id:"refresh-data-window",level:3},{value:"Behavior on Zero Results",id:"behavior-on-zero-results",level:2},{value:"Refresh Interval",id:"refresh-interval",level:2},{value:"Retention Policy",id:"retention-policy",level:2}];function o(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,n.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.h2,{id:"refresh-modes",children:"Refresh Modes"}),"\n",(0,a.jsxs)(t.p,{children:["Spice supports three modes to refresh/update local data from a connected data source. ",(0,a.jsx)(t.code,{children:"full"})," is the default mode."]}),"\n",(0,a.jsxs)(t.table,{children:[(0,a.jsx)(t.thead,{children:(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.th,{children:"Mode"}),(0,a.jsx)(t.th,{children:"Description"}),(0,a.jsx)(t.th,{children:"Example"})]})}),(0,a.jsxs)(t.tbody,{children:[(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"full"})}),(0,a.jsx)(t.td,{children:"Replace/overwrite the entire dataset on each refresh"}),(0,a.jsx)(t.td,{children:"A table of mutable users"})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"append"})}),(0,a.jsx)(t.td,{children:"Append/add data to the dataset on each refresh"}),(0,a.jsx)(t.td,{children:"Append-only immutable datasets, like time-series or blockchain data"})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"changes"})}),(0,a.jsx)(t.td,{children:"*Coming soon. Apply incremental changes"}),(0,a.jsx)(t.td,{children:"Any mutable or immutable dataset"})]})]})]}),"\n",(0,a.jsx)(t.p,{children:"E.g."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",children:"datasets:\n  - from: databricks:my_dataset\n    name: accelerated_dataset\n    acceleration:\n      refresh_mode: full\n      refresh_check_interval: 10m\n"})}),"\n",(0,a.jsxs)(t.p,{children:["If the dataset definition includes a ",(0,a.jsx)(t.code,{children:"time_column"})," and the refresh mode is ",(0,a.jsx)(t.code,{children:"append"}),", data will be refreshed for data where the ",(0,a.jsx)(t.code,{children:"time_column"})," value in the remote source is greater-than (gt) the ",(0,a.jsx)(t.code,{children:"max(time_column)"})," value in the local acceleration."]}),"\n",(0,a.jsx)(t.p,{children:"E.g."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",children:"datasets:\n  - from: databricks:my_dataset\n    name: accelerated_dataset\n    time_column: timestamp\n    acceleration:\n      refresh_mode: append # In conjuction with time_column, only fetch data greater than the latest local timestamp\n      refresh_check_interval: 10m\n"})}),"\n",(0,a.jsx)(t.h2,{id:"filtered-refresh",children:"Filtered Refresh"}),"\n",(0,a.jsx)(t.p,{children:"Typically only a working subset of an entire dataset is used in an application or dashboard. Use these features to filter refresh data, creating a smaller subset for faster processing and to reduce the data transferred and stored locally."}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.a,{href:"#refresh-sql",children:"Refresh SQL"})," - Specify the filter as arbitrary SQL to be pushed down to the remote source."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.a,{href:"#refresh-data-window",children:"Refresh Data Window"})," - Filters data from the remote source outside the specified time window."]}),"\n"]}),"\n",(0,a.jsx)(t.h3,{id:"refresh-sql",children:"Refresh SQL"}),"\n",(0,a.jsxs)(t.p,{children:["Specify filters for data accelerated from the connected source using arbitrary SQL. Supported for ",(0,a.jsx)(t.code,{children:"full"})," and ",(0,a.jsx)(t.code,{children:"append"})," refresh modes."]}),"\n",(0,a.jsx)(t.p,{children:"Filters will be pushed down to the remote source, and only the requested data will be transferred over the network."}),"\n",(0,a.jsx)(t.p,{children:"Example:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",children:"datasets:\n  - from: databricks:my_dataset\n    name: accelerated_dataset\n    acceleration:\n      enabled: true\n      refresh_mode: full\n      refresh_check_interval: 10m\n      refresh_sql: |\n        SELECT * FROM accelerated_dataset WHERE city = 'Seattle'\n"})}),"\n",(0,a.jsxs)(t.p,{children:["The ",(0,a.jsx)(t.code,{children:"refresh_sql"})," parameter can be updated at runtime on-demand using ",(0,a.jsx)(t.code,{children:"PATCH /v1/datasets/:name/acceleration"}),". This change is temporary and will revert at the next runtime restart."]}),"\n",(0,a.jsx)(t.p,{children:"Example:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:'curl -i -X PATCH \\\n     -H "Content-Type: application/json" \\\n     -d \'{\n           "refresh_sql": "SELECT * FROM accelerated_dataset WHERE city = \'Bellevue\'"\n         }\' \\\n     127.0.0.1:3000/v1/datasets/accelerated_dataset/acceleration\n'})}),"\n",(0,a.jsxs)(t.p,{children:["For the complete reference, view the ",(0,a.jsx)(t.code,{children:"refresh_sql"})," section of ",(0,a.jsx)(t.a,{href:"/reference/spicepod/datasets#accelerationrefresh_sql",children:"datasets"}),"."]}),"\n",(0,a.jsx)(t.admonition,{title:"Limitations",type:"warning",children:(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:"The refresh SQL only supports filtering data from the current dataset - joining across other datasets is not supported."}),"\n",(0,a.jsxs)(t.li,{children:["Selecting a subset of columns isn't supported - the refresh SQL needs to start with ",(0,a.jsx)(t.code,{children:"SELECT * FROM {name}"}),"."]}),"\n",(0,a.jsx)(t.li,{children:"Queries for data that have been filtered out will not fall back to querying against the federated table."}),"\n",(0,a.jsx)(t.li,{children:"Refresh SQL modifications made via API are temporary and will revert after a runtime restart."}),"\n"]})}),"\n",(0,a.jsx)(t.h3,{id:"refresh-data-window",children:"Refresh Data Window"}),"\n",(0,a.jsxs)(t.p,{children:["Filters data from the federated source outside than the specified window. The only supported window is a lookback starting from ",(0,a.jsx)(t.code,{children:"now() - refresh_data_window"})," to ",(0,a.jsx)(t.code,{children:"now()"}),". This flag is only supported for datasets configured with a ",(0,a.jsx)(t.code,{children:"full"})," refresh mode (the default)."]}),"\n",(0,a.jsxs)(t.p,{children:["Used in combination with the ",(0,a.jsx)(t.a,{href:"/reference/spicepod/datasets#time_column",children:(0,a.jsx)(t.code,{children:"time_column"})})," to identify the column that contains the timestamps to filter on. The ",(0,a.jsx)(t.a,{href:"/reference/spicepod/datasets#time_format",children:(0,a.jsx)(t.code,{children:"time_format"})})," column (optional) can be used to instruct the Spice runtime how to interpret the timestamps in the ",(0,a.jsx)(t.code,{children:"time_column"}),"."]}),"\n",(0,a.jsxs)(t.p,{children:["Can also be combined with ",(0,a.jsx)(t.code,{children:"refresh_sql"})," to further filter the data based on the temporal dimension."]}),"\n",(0,a.jsx)(t.p,{children:"Example:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",children:"datasets:\n  - from: databricks:my_dataset\n    name: accelerated_dataset\n    time_column: created_at\n    acceleration:\n      enabled: true\n      refresh_mode: full\n      refresh_check_interval: 10m\n      refresh_sql: |\n        SELECT * FROM accelerated_dataset WHERE city = 'Seattle'\n      refresh_data_window: 1d\n"})}),"\n",(0,a.jsxs)(t.p,{children:["This configuration will only accelerate data from the federated source that matches the filter ",(0,a.jsx)(t.code,{children:"city = 'Seattle'"})," and is less than 1 day old."]}),"\n",(0,a.jsx)(t.h2,{id:"behavior-on-zero-results",children:"Behavior on Zero Results"}),"\n",(0,a.jsxs)(t.p,{children:["By default, accelerated datasets will only return results that have been accelerated locally. If the locally accelerated data is a subset of the full dataset in the federated source, i.e. through setting ",(0,a.jsx)(t.code,{children:"refresh_sql"}),", ",(0,a.jsx)(t.code,{children:"refresh_data_window"})," or configuring retention policies, queries against the accelerated dataset may return zero results, where the federated table would return results."]}),"\n",(0,a.jsxs)(t.p,{children:["Control this behavior by setting ",(0,a.jsx)(t.code,{children:"on_zero_results"})," in the acceleration configuration."]}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.code,{children:"on_zero_results"}),":"]}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"return_empty"})," (Default) - Return an empty result set when no data is found in the accelerated dataset."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"use_source"})," - Fall back to querying the federated table when no data is found in the accelerated dataset."]}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:"Example:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",children:"datasets:\n  - from: databricks:my_dataset\n    name: accelerated_dataset\n    acceleration:\n      enabled: true\n      refresh_sql: SELECT * FROM accelerated_dataset where city = 'Seattle'\n      on_zero_results: use_source\n"})}),"\n",(0,a.jsxs)(t.p,{children:["In this example a query against ",(0,a.jsx)(t.code,{children:"accelerated_dataset"})," within Spice like ",(0,a.jsx)(t.code,{children:"SELECT * FROM accelerated_dataset WHERE city = 'Portland'"})," would initially query against the accelerated data, see that it returns zero results and then fallback to querying against the federated table in Databricks."]}),"\n",(0,a.jsx)(t.admonition,{type:"warning",children:(0,a.jsxs)(t.p,{children:["It is possible that even though the accelerated table returns some results, it may not contain all the data that would be returned by the federated table. ",(0,a.jsx)(t.code,{children:"on_zero_results"})," only controls the behavior in the simple case where no data is returned by the acceleration for a given query."]})}),"\n",(0,a.jsx)(t.h2,{id:"refresh-interval",children:"Refresh Interval"}),"\n",(0,a.jsxs)(t.p,{children:["For accelerated datasets in ",(0,a.jsx)(t.code,{children:"full"})," mode, the ",(0,a.jsx)(t.a,{href:"/reference/spicepod/datasets#accelerationrefresh_check_interval",children:(0,a.jsx)(t.code,{children:"refresh_check_interval"})})," parameter controls how often the accelerated dataset is refreshed."]}),"\n",(0,a.jsx)(t.p,{children:"Example:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",children:"datasets:\n  - from: spice.ai/eth.recent_blocks\n    name: eth_recent_blocks\n    acceleration:\n      enabled: true\n      refresh_mode: full\n      refresh_check_interval: 10s\n"})}),"\n",(0,a.jsxs)(t.p,{children:["This configuration will refresh ",(0,a.jsx)(t.code,{children:"eth.recent_blocks"})," data every 10 seconds."]}),"\n",(0,a.jsxs)(t.p,{children:["Accelerated datasets can also be refreshed on-demand via the ",(0,a.jsx)(t.code,{children:"refresh"})," CLI command or ",(0,a.jsx)(t.code,{children:"POST /v1/datasets/:name/acceleration/refresh"})," API endpoint."]}),"\n",(0,a.jsx)(t.p,{children:"An example using cURL:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"curl -i -XPOST 127.0.0.1:3000/v1/datasets/eth_recent_blocks/refresh\n"})}),"\n",(0,a.jsx)(t.p,{children:"And response"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:'HTTP/1.1 201 Created\ncontent-type: application/json\ncontent-length: 55\ndate: Thu, 11 Apr 2024 20:11:18 GMT\n\n{"message":"Dataset refresh triggered for eth_recent_blocks."}\n'})}),"\n",(0,a.jsx)(t.h2,{id:"retention-policy",children:"Retention Policy"}),"\n",(0,a.jsx)(t.p,{children:"A retention policy automatically removes data from accelerated datasets with a temporal column that exceeds the defined retention period, optimizing resource utilization."}),"\n",(0,a.jsxs)(t.p,{children:["The policy is set using the ",(0,a.jsx)(t.a,{href:"/reference/spicepod/datasets#accelerationretention_check_enabled",children:(0,a.jsx)(t.code,{children:"acceleration.retention_check_enabled"})}),", ",(0,a.jsx)(t.a,{href:"/reference/spicepod/datasets#accelerationretention_period",children:(0,a.jsx)(t.code,{children:"acceleration.retention_period"})})," and ",(0,a.jsx)(t.a,{href:"/reference/spicepod/datasets#accelerationretention_check_interval",children:(0,a.jsx)(t.code,{children:"acceleration.retention_check_interval"})})," parameters, along with the ",(0,a.jsx)(t.a,{href:"/reference/spicepod/datasets#time_column",children:(0,a.jsx)(t.code,{children:"time_column"})})," and ",(0,a.jsx)(t.a,{href:"/reference/spicepod/datasets#time_format",children:(0,a.jsx)(t.code,{children:"time_format"})})," dataset parameters."]})]})}function h(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(o,{...e})}):o(e)}},8453:(e,t,r)=>{r.d(t,{R:()=>d,x:()=>i});var a=r(6540);const n={},s=a.createContext(n);function d(e){const t=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:d(e.components),a.createElement(s.Provider,{value:t},e.children)}}}]);