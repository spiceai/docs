---
title: 'S3 Data Connector'
sidebar_label: 'S3 Data Connector'
description: 'S3 Data Connector Documentation'
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

The S3 Data Connector enables federated SQL query across Parquet/CSV files stored in S3, or S3-compatible storage solutions (e.g. MinIO, Cloudflare R2).

Support for Iceberg and other file-formats are on the roadmap.

If a folder is provided, all child Parquet/CSV files will be loaded.

```yaml
datasets:
  # Using access keys
  - from: s3://s3-bucket-name/path/to/parquet/cool_dataset.parquet
    name: cool_dataset
    params:
      s3_auth: key
      s3_key: ${secrets:S3_KEY}
      s3_secret: ${secrets:S3_SECRET}
  # Using IAM roles
  - from: s3://s3-bucket-name/path/to/parquet/cool_dataset2.parquet
    name: cool_dataset2
    params:
      s3_auth: iam_role
  # Using a public bucket
  - from: s3://spiceai-demo-datasets/taxi_trips/2024/
    name: taxi_trips
    params:
      file_format: parquet
```

## Dataset Schema Reference

### `from`

The S3-compatible URI to a folder or object in form `from: s3://<bucket>/<file>`

Example: `from: s3://s3-bucket-name/path/to/parquet/cool_dataset.parquet`

### `name`

The dataset name.

Example: `name: cool_dataset`

### `params`

- `file_format`: Specifies the data file format. Required if the format cannot be inferred by from the `from` path.
  - `parquet`: Parquet file format.
  - `csv`: CSV file format.
- `s3_endpoint`: The S3 endpoint, or equivalent (e.g. MinIO endpoint), for the S3-compatible storage. Defaults to region endpoint. E.g. `s3_endpoint: https://my.minio.server`
- `s3_region`: Region of the S3 bucket, if region specific. Default value is `us-east-1` E.g. `s3_region: us-east-1`
- `client_timeout`: Specifies timeout for S3 operations. Default value is `30s` E.g. `client_timeout: 60s`

More CSV related parameters can be configured, see [CSV Parameters](/reference/file_format.md#csv)

## Auth

Not required for public endpoints. Use the [secret replacement syntax](../secret-stores/index.md) to load the password from a secret store, e.g. `${secrets:my_dremio_pass}`.

- `s3_auth`: (Optional) The authentication method to use. Values are `public`, `key` and `iam_role`. Defaults to `public` if `s3_key` and `s3_secret` are not provided, otherwise defaults to `key`.
- `s3_key`: The access key (e.g. `AWS_ACCESS_KEY_ID` for AWS)
- `s3_secret`: The secret key (e.g. `AWS_SECRET_ACCESS_KEY` for AWS)

For non-public buckets, `s3_auth: key` or `s3_auth: iam_role` is required. `s3_auth: iam_role` will use the [AWS IAM role](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html) of currently running instance.

<Tabs>
  <TabItem value="env" label="Env">

    ```bash
    SPICE_S3_KEY=AKIAIOSFODNN7EXAMPLE \
    SPICE_S3_SECRET=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY \
    spice run
    # Or using the CLI to configure the secrets into an `.env` file
    spice login s3 -k AKIAIOSFODNN7EXAMPLE -s wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
    ```

    `.env`
    ```bash
    SPICE_S3_KEY=AKIAIOSFODNN7EXAMPLE
    SPICE_S3_SECRET=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
    ```

    `spicepod.yaml`
    ```yaml
    version: v1beta1
    kind: Spicepod
    name: spice-app

    secrets:
      - from: env
        name: env

    datasets:
      - from: s3://s3-bucket-name/path/to/parquet/cool_dataset.parquet
        name: cool_dataset
        params:
          s3_region: us-east-1
          s3_key: ${env:SPICE_S3_KEY}
          s3_secret: ${env:SPICE_S3_SECRET}
    ```

    Learn more about [Env Secret Store](/components/secret-stores/env).

  </TabItem>
  <TabItem value="k8s" label="Kubernetes">
    ```bash
    kubectl create secret generic s3 \
      --from-literal=key='AKIAIOSFODNN7EXAMPLE' \
      --from-literal=secret='wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY'
    ```

    `spicepod.yaml`
    ```yaml
    version: v1beta1
    kind: Spicepod
    name: spice-app

    secrets:
      - from: kubernetes:s3
        name: s3

    datasets:
      - from: s3://s3-bucket-name/path/to/parquet/cool_dataset.parquet
        name: cool_dataset
        params:
          s3_region: us-east-1
          s3_key: ${s3:key}
          s3_secret: ${s3:secret}
    ```

    Learn more about [Kubernetes Secret Store](/components/secret-stores/kubernetes).

  </TabItem>
  <TabItem value="keyring" label="Keyring">
    Add new keychain entries (macOS) for the key and secret:

    ```bash
    # Add Key to keychain
    security add-generic-secret -l "S3 Key" \
    -a spiced -s spice_s3_key \
    -w AKIAIOSFODNN7EXAMPLE
    # Add Secret to keychain
    security add-generic-secret -l "S3 Secret" \
    -a spiced -s spice_s3_secret \
    -w wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
    ```

    `spicepod.yaml`
    ```yaml
    version: v1beta1
    kind: Spicepod
    name: spice-app

    secrets:
      - from: keyring
        name: keyring

    datasets:
      - from: s3://s3-bucket-name/path/to/parquet/cool_dataset.parquet
        name: cool_dataset
        params:
          s3_region: us-east-1
          s3_key: ${keyring:spice_s3_key}
          s3_secret: ${keyring:spice_s3_secret}
    ```

    Learn more about [Keyring Secret Store](/components/secret-stores/keyring).

  </TabItem>
</Tabs>

## Examples

### MinIO Example

Create a dataset named `cool_dataset` from a Parquet file stored in MinIO.

```yaml
- from: s3://s3-bucket-name/path/to/parquet/cool_dataset.parquet
  name: cool_dataset
  params:
    s3_endpoint: https://my.minio.server
    s3_region: 'us-east-1' # Best practice for Minio
```

### S3 Public Example

Create a dataset named `taxi_trips` from a public S3 folder.

```yaml
- from: s3://spiceai-demo-datasets/taxi_trips/2024/
  name: taxi_trips
  params:
    file_format: parquet
```
